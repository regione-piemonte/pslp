<!--
 * ========================LICENSE_START=================================
 * Copyright (C) 2025 Regione Piemonte
 * SPDX-FileCopyrightText: Copyright 2025 | Regione Piemonte
 * SPDX-License-Identifier: EUPL-1.2
 * =========================LICENSE_END==================================
 -->
<ngb-accordion #acc="ngbAccordion" activeIds="informaticaFascicolo,informaticaCv">
  <ngb-panel title="{{messaggioConoscenzaInfFasc?.testo}}" id="informaticaFascicolo">
    <ng-template ngbPanelContent>
    <div class="table-container mt-3 mb-5">
      <p-table
    #dt
    [value]="conoscenzeInformaticheFiltrate"
    dataKey="id"
    styleClass="p-datatable-customers"
    [rowHover]="true"

    [rows]="5"
    [showCurrentPageReport]="true"
    [rowsPerPageOptions]="[5,10,25,50]"

    [loading]="false"
    responsiveLayout="scroll"
    [paginator]="true"
    currentPageReportTemplate="{first} di {last}, su {totalRecords} righe">
    <ng-template pTemplate="header">
          <tr>
            <th>Conoscenza informatica</th>
            <th>Categoria</th>
            <th>Grado conoscenza</th>
            <th>Modalit√† apprendimento</th>
            <th>Certificato</th>
            <th>Azione</th>
          </tr>
        
        </ng-template>
        <ng-template pTemplate="body" let-el >
        <ng-container *ngIf="conoscenzeInformaticheFiltrate?.length">
          <tr>
            <td>{{ el?.conoscenzaSpecifica?.descr || '--'}}</td>
            <td>{{ el?.tipoConoscenza?.descr || '--'}}</td>
            <td>{{ el?.gradoConoscenza?.descr || '--'}}</td>
            <td>{{ el?.modalitaApprendimento?.descr || '--' }}</td>
            <td>{{ el?.lavInformatica?.flgCertificato ? 'SI' : 'NO'}}</td>
            <td class="col-md-1" style="min-width: 90px;">
              <a tabindex="0" style="color: #016CB4" aria-label="Azione: visualizzare dettaglio competenza informatica"
              (click)="onVisualizzaCompetenzaInformaticaFascicolo(el)"
              title="Visualizzare dettaglio competenza informatica">
                <i class="fas fa-eye"></i>
              </a>
              <a tabindex="0" (click)="inserisciConoscenzaInfoDaFascicolo(el)" (keydown.enter)="inserisciConoscenzaInfoDaFascicolo(el)" style="color: #016CB4" aria-label="Azione: Aggiunge competenza informatica"
                title="Aggiungere competenza informatica al CV" *ngIf="canModifica">
                <i class="fas fa-file-download"></i>
              </a>
            </td>
          </tr>
          
      </ng-container>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
          <td colspan="6">
            {{messaggioNonCiSonoDati?.testo}}
          </td>
      </tr>
  </ng-template>
  </p-table>

      <em data-scroll-marker="formCompetenzaInformatica"></em>
    </div>
  </ng-template>
  </ngb-panel>
  <ngb-panel title="{{messaggioConoscenzaInfCv?.testo}}" id="informaticaCv">
    <ng-template ngbPanelContent>
    <div class="table-container mt-3 mb-5">
      <table class="table table-bordered table-striped table-hover table-sortable"
        id="infoTableConoscenze informatiche">
        <thead>
          <tr>
            <th>Conoscenza informatica</th>
            <th>Categoria</th>
            <th>Livello conoscenza/utilizzo</th>
            <th>Azione</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngIf="conoscenzeInformaticheCv?.length; else noData">
          <tr *ngFor="let el of conoscenzeInformaticheCv">
            <td>{{ el?.dsSpecifiche}}</td>
            <td>{{ el?.dsTipoConoscenza}}</td>
            <td>{{ el?.livelloConoscenza?(el?.livelloConoscenza=='E'?'SPECIALISTICA':'DI BASE'):'--'}}</td>
            <td class="col-md-1"  style="min-width: 90px;">
              <a tabindex="0" (click)="patchForm(el,'v')" style="color: #016CB4" aria-label="Azione: visualizzare dettaglio competenza informatica"
                title="Visualizzare dettaglio competenza informatica"  >
                <i class="fas fa-eye"></i>
              </a>
              <a tabindex="0" (click)="patchForm(el,'m')" style="color: #016CB4" aria-label="Azione: modificare competenza informatica"
                title="Modificare competenza informatica" *ngIf="canModifica">
                <i class="fas fa-edit"></i>
              </a>
              <a tabindex="0" (click)="onClickEliminaInformaticaCv(el)" aria-label="Azione: eliminare competenza informatica"
                title="Eliminare competenza informatica dal CV" *ngIf="canModifica">
                <i class="fas fa-trash-alt"></i>
              </a>

            </td>
          </tr>
        </ng-container>
        <ng-template #noData>
          <tr>
            <td colspan="6">Non ci sono dati</td>
          </tr>
        </ng-template>
        </tbody>
      </table>
    </div>
    <button type="button" class="btn btn-primary btn-lg" (click)="toggleForm(false)" *ngIf="canModifica">INSERISCI NUOVA CONOSCENZA</button>
      <div *ngIf="showForm">
        <div class="mt-3 row">
          <h3>DETTAGLIO CONOSCENZE INFORMATICHE</h3>
          <form [formGroup]="form">

            <!-- Conoscenza informatica -- Categoria  -->
            <div class="mt-3 row" formGroupName="silTInformaticaDett">
              <div class="mb-5 col-sm-12 col-md-6" >
                <label for="tipoConoscenza">Conoscenza informatica<span class="oblg">*</span></label>
                <p-dropdown optionLabel="descr" optionValue="id"  inputId="tipoConoscenza"
                [filter]="true" (onFilter)="onFilterInformaticaDett($event)"
                  ariaLabel="tipo conoscenza"
                [emptyMessage]="'Nessun dato trovato'" [autoDisplayFirst]="false"
                  [options]="informaticaDett" formControlName="id"
                  class=" p-form-select" placeholder=""bindLabel="descr"
                  (onChange)="onChangeInformaticaDett($event)"   [disabled]="!!conoscenzaSelected">
                </p-dropdown>
              </div>
              <div class="mb-5 col-sm-12 col-md-6" formGroupName="informatica">
                <label for="categoria">Categoria</label>
                <input type="text" pInputText class="form-control" formControlName="descr" id="categoria"
                 aria-label="categoria" [value]="categoria">
              </div>
            </div>

            <!-- Fine Conoscenza informatica -- Categoria  -->
            <div class="row">

              <div class="mb-5 col-sm-12 col-md-3">
                <fieldset>
                  <legend>Livello</legend><br>
                  <div *ngFor="let item of [{key:'Di base',id:'U'},{key:'Specialistica',id:'E'}]"
                    class="mb-3 col-auto form-check form-check-inline">
                    <input class="form-check-input" name="livello"
                      formControlName="livello" [value]="item.id" type="radio" id="livello{{item.id}}"
                      [attr.aria-labelledby]="'livello'+item.id">
                    <label class="form-check-label" for="livello{{item.id}}">
                      {{item.key}}
                    </label>
                  </div>
                </fieldset>
              </div>
            </div>
            <div class="row">
              <div class="col mt-3">
                <button type="button" (click)="toggleForm(true)" class="btn btn-outline-secondary btn-sm"
                  aria-label="annulla inserimento">ANNULLA</button>
              </div>
              <div class="col-auto mt-3">
                <button type="submit" [disabled]="!form?.valid" *ngIf="canModifica" (click)="inserisciAggiornaConoscenzaCv()"
                  class="btn btn-primary ml-auto btn-lg" aria-label="conferma inserimento dati">CONFERMA</button>
              </div>
            </div>

          </form>


        </div>

      </div>
    </ng-template>
  </ngb-panel>
</ngb-accordion>
